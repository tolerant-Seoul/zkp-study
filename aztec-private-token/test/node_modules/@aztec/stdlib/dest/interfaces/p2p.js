import { z } from 'zod';
import { BlockAttestation } from '../p2p/block_attestation.js';
import { optional, schemas } from '../schemas/index.js';
import { Tx } from '../tx/tx.js';
import { TxHash } from '../tx/tx_hash.js';
import { MAX_RPC_TXS_LEN } from './api_limit.js';
const PeerInfoSchema = z.discriminatedUnion('status', [
    z.object({
        status: z.literal('connected'),
        score: z.number(),
        id: z.string()
    }),
    z.object({
        status: z.literal('dialing'),
        dialStatus: z.string(),
        id: z.string(),
        addresses: z.array(z.string())
    }),
    z.object({
        status: z.literal('cached'),
        id: z.string(),
        addresses: z.array(z.string()),
        enr: z.string(),
        dialAttempts: z.number()
    })
]);
export const P2PApiSchema = {
    getAttestationsForSlot: z.function().args(schemas.BigInt, optional(z.string())).returns(z.array(BlockAttestation.schema)),
    getPendingTxs: z.function().args(optional(z.number().gte(1).lte(MAX_RPC_TXS_LEN).default(MAX_RPC_TXS_LEN)), optional(TxHash.schema)).returns(z.array(Tx.schema)),
    getPendingTxCount: z.function().returns(schemas.Integer),
    getEncodedEnr: z.function().returns(z.string().optional()),
    getPeers: z.function().args(optional(z.boolean())).returns(z.array(PeerInfoSchema)),
    deleteAttestation: z.function().args(BlockAttestation.schema).returns(z.void())
};
